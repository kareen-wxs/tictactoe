# Диагностика проблем с Telegram

## Промокод не приходит в Telegram? Проверьте следующее:

### 1. Проверьте настройки в .env

Убедитесь, что в файле `.env` есть:
```env
TELEGRAM_BOT_TOKEN=ваш_токен_здесь
TELEGRAM_CHAT_ID=ваш_chat_id_здесь
```

**Важно:** После изменения `.env` нужно перезапустить сервер:
```bash
# Остановите сервер (Ctrl+C) и запустите снова
php artisan serve
```

### 2. Проверьте, что вы написали боту первым

**Это критически важно!** Бот не может отправить вам сообщение, если вы ему не написали первым.

1. Найдите вашего бота в Telegram (по username, который вы указали при создании)
2. Напишите ему `/start` или любое сообщение
3. Бот должен ответить (даже если это просто автоматический ответ)

### 3. Проверьте консоль браузера

1. Откройте игру в браузере
2. Нажмите `F12` (или `Ctrl+Shift+I` в Chrome)
3. Перейдите на вкладку **Console**
4. Выиграйте игру
5. Посмотрите, какие сообщения появляются в консоли

Вы должны увидеть:
- `Генерация промокода...`
- `Промокод сгенерирован: XXXXX`
- `Отправка сообщения в Telegram: Победа! Промокод выдан: XXXXX`
- `Ответ от сервера: {success: true}`

Если видите ошибки - скопируйте их и проверьте ниже.

### 4. Проверьте логи Laravel

Логи находятся в файле: `storage/logs/laravel.log`

Откройте файл и найдите последние записи. Ищите:
- `Telegram API error`
- `Telegram send error`
- `Отправка сообщения в Telegram`

### 5. Частые ошибки и решения

#### Ошибка: "chat not found"
**Решение:** Вы не написали боту первым сообщение. Напишите боту `/start`

#### Ошибка: "Unauthorized"
**Решение:** Неверный токен бота. Проверьте `TELEGRAM_BOT_TOKEN` в `.env`

#### Ошибка: "Forbidden"
**Решение:** Бот заблокирован или удален. Создайте нового бота

#### Ошибка: "TELEGRAM_BOT_TOKEN не настроен"
**Решение:** Добавьте токен в `.env` и перезапустите сервер

#### Ошибка: "TELEGRAM_CHAT_ID не настроен"
**Решение:** Добавьте Chat ID в `.env` и перезапустите сервер

### 6. Тест вручную

Проверьте, что бот работает, отправив запрос напрямую:

```bash
# Замените YOUR_BOT_TOKEN и YOUR_CHAT_ID на ваши значения
curl -X POST "https://api.telegram.org/botYOUR_BOT_TOKEN/sendMessage" \
  -d "chat_id=YOUR_CHAT_ID" \
  -d "text=Тестовое сообщение"
```

Если это работает - проблема в коде приложения.
Если не работает - проблема в настройке бота.

### 7. Проверка Chat ID

Убедитесь, что Chat ID правильный:
- Для личного чата: положительное число (например: `123456789`)
- Для группы: отрицательное число (например: `-1001234567890`)

Получить Chat ID можно через [@userinfobot](https://t.me/userinfobot)

### 8. Проверка токена

Токен должен выглядеть так: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

Получить токен можно через [@BotFather](https://t.me/BotFather) командой `/token`

